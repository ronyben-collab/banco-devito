<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<title>Banco Devito</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase compat (OBLIGATORIO) -->

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:white;font-family:Arial;margin:0;padding:15px;}
.card{border:1px solid #333;border-radius:10px;padding:15px;margin-bottom:15px;}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none;}
button{background:#1e90ff;color:white;font-weight:bold;cursor:pointer;}
button.red{background:#ff4d4d;}
.hidden{display:none;}
.item{border-bottom:1px solid #333;padding:8px 0;}
</style>

</head>
<body>

<h2>üè¶ Banco Devito</h2>

<!-- LOGIN -->

<div id="loginBox" class="card">
  <input id="email" type="email" placeholder="Correo">
  <input id="pass" type="password" placeholder="Contrase√±a (m√≠n 6)">
  <button onclick="login()">Iniciar sesi√≥n</button>
  <button onclick="register()">Crear cuenta</button>
</div>

<!-- BANCO -->

<div id="bankBox" class="hidden">
  <div class="card">
    <b>Saldo:</b> <span id="saldo">0</span> coins<br>
    <b>Cuenta:</b> <span id="cuentaId"></span><br>
    <b>Score:</b> <span id="score">500</span>
  </div>

<button onclick="logout()">Cerrar sesi√≥n</button>

</div>

<script>
/***** CONFIGURA TU FIREBASE REAL AQUI *****/
const firebaseConfig = {
  apiKey: "REEMPLAZA_AQUI",
  authDomain: "REEMPLAZA_AQUI",
  databaseURL: "REEMPLAZA_AQUI",
  projectId: "REEMPLAZA_AQUI"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let cuenta = "";

/***** SESION *****/
auth.onAuthStateChanged(user => {
  if(user){
    loginBox.classList.add('hidden');
    bankBox.classList.remove('hidden');
    cargarBanco(user.uid);
  } else {
    loginBox.classList.remove('hidden');
    bankBox.classList.add('hidden');
  }
});

/***** LOGIN *****/
function login(){
  if(!email.value || !pass.value) return alert("Completa los datos");
  auth.signInWithEmailAndPassword(email.value, pass.value)
    .catch(e => alert(e.message));
}

/***** REGISTRO *****/
function register(){
  if(!email.value || !pass.value) return alert("Completa los datos");
  auth.createUserWithEmailAndPassword(email.value, pass.value)
  .then(r => {
    const uid = r.user.uid;
    cuenta = "DEV-" + Math.floor(100000 + Math.random()*900000);
    db.ref("usuarios/"+uid).set({cuenta, score:500});
    db.ref("cuentas/"+cuenta).set({saldo:1000});
    alert("Cuenta creada correctamente");
  })
  .catch(e => alert(e.message));
}

/***** CARGAR DATOS *****/
function cargarBanco(uid){
  db.ref("usuarios/"+uid).once("value").then(snap => {
    if(!snap.exists()) return;
    cuenta = snap.val().cuenta;
    cuentaId.innerText = cuenta;
    score.innerText = snap.val().score || 500;

    db.ref("cuentas/"+cuenta+"/saldo").on("value", v => {
      saldo.innerText = v.val() || 0;
    });
  });
}

/***** LOGOUT *****/
function logout(){ auth.signOut(); }
</script>

</body>
</html>
